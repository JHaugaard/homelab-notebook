# Session Context - Homelab Notebook

**Last Updated:** 2025-12-01
**Session Purpose:** Fix app initialization and PocketBase integration

---

## Workflow Progress

| Phase | Status | Notes |
|-------|--------|-------|
| Project Brief v2 | COMPLETE | .docs/homelab-notebook-brief-v1.md |
| UI/UX Redesign | COMPLETE | .docs/ui-ux-redesign-v2.md |
| Migration Phase 1 | COMPLETE | Core structure, routes, AppShell, sidebar |
| Migration Phase 2 | COMPLETE | Entry features, forms, timeline, editor, tags |
| Migration Phase 3 | COMPLETE | Projects & organization |
| Migration Phase 4 | COMPLETE | Search & navigation (FlexSearch, ⌘K) |
| Migration Phase 5 | COMPLETE | Mode promotion, cross-refs, dashboard |
| Migration Phase 6 | COMPLETE | Polish, loading states, AI stubs |
| PocketBase Setup | COMPLETE | Collections created, API rules configured |
| App Init Fix | COMPLETE | Fixed SSR hydration blocking issue |

**Mode:** DELIVERY (practical utility focus)

---

## Current State

### Today's Session (2025-12-01) - Bug Fixes

#### Issues Fixed

1. **CSS @import order error** - Google Fonts `@import` was after Tailwind, causing PostCSS error. Moved fonts import to top of `app.css`.

2. **PocketBase API 403 errors** - All collection API rules were set to "Superusers only". Unlocked and cleared rules for `entries`, `projects`, `tags` collections to allow public access.

3. **App stuck on loading spinner** - SSR hydration issue where `onMount` wasn't executing to flip `loading` from `true` to `false`. Root cause likely FlexSearch module-level subscription blocking hydration. Fixed by removing loading gate entirely - app now renders immediately and loads data in background.

#### Configuration Changes

- **PocketBase instance**: Running on port 8095 (not 8090)
- **ENV**: `PUBLIC_POCKETBASE_URL=http://localhost:8095` in `.env.local`
- **API Rules**: All collections (entries, projects, tags) have empty rules (public access for dev)

---

## What's Built

### Three-Mode Architecture
- **Research Mode** (`/research`) - Resource collection, URLs, links
- **Project Mode** (`/project`) - Developer journal with timeline view
- **Reference Mode** (`/reference`) - Polished documentation/tutorials

### Core Features
- Mode promotion workflow (move/copy entries between modes)
- Cross-entry linking system
- FlexSearch-powered instant search (⌘K)
- Quick capture modal (⌘N)
- Project timeline with date groupings
- Toast notifications
- View preferences (persisted to localStorage)

### Routes
- `/` - Dashboard with mode overview, recent entries, active projects
- `/research`, `/research/new`, `/research/[id]`, `/research/[id]/edit`
- `/project`, `/project/new`, `/project/[id]`, `/project/[id]/edit`
- `/reference`, `/reference/new`, `/reference/[id]`, `/reference/[id]/edit`
- `/projects`, `/projects/[id]` - Project management
- `/tags` - Tag management
- `/recent` - Recent entries across all modes
- `/archived` - Archived entries
- `/settings` - View preferences and keyboard shortcuts

### Components
- **Layout:** AppShell, Sidebar, Header, Toast
- **UI:** Button, Input, Badge, Modal, Skeleton, EmptyState, ErrorBanner
- **Editor:** MarkdownEditor, TagInput
- **Features:** QuickCaptureModal, NewProjectModal, PromoteEntryModal, LinkEntriesModal
- **Nav:** GlobalSearch

### Stores
- `entries` - Entry CRUD with mode filtering
- `projects` - Project management
- `tags` - Tag management
- `ui` - UI state, toasts, view preferences
- `search` - FlexSearch integration

### Services
- `pocketbase.ts` - PocketBase client and CRUD operations
- `ai.ts` - Ollama integration stubs (for future AI features)

---

## Key Architecture Decisions

### Mode Philosophy
- **Primary mode with promotion** - Entries start in one mode, can be promoted/moved
- **Projects optional** - Entries don't require a project association
- **Flexible timeline** - Both newest-first and oldest-first views available

### Data Model
```
entries: id, mode, title, content, url, project, tags[], linked_entries[], promoted_from, archived
projects: id, name, description, status, color
tags: id, name, category, color, auto_generated
```

### Mode Colors
- Research: Blue (`text-blue-600`, `bg-blue-50`)
- Project: Amber (`text-amber-600`, `bg-amber-50`)
- Reference: Green (`text-green-600`, `bg-green-50`)

---

## Known Issues

1. **Vite version conflict** - TypeScript error in vite.config.ts (pre-existing, doesn't affect runtime)
2. **GlobalSearch warning** - `inputEl` not declared with `$state()` (Svelte 5 warning, non-blocking)

---

## Next Actions

1. Test full CRUD operations with PocketBase
2. Add sample data to test UI
3. Deploy to production (notebook.haugaard.dev)

---

## Reference Files

- `.docs/homelab-notebook-brief-v1.md` - Alternative project brief (three-mode system)
- `.docs/ui-ux-redesign-v2.md` - Comprehensive UI/UX specification
- `CLAUDE.md` - Updated project documentation
- `src/lib/types/index.ts` - TypeScript types and mode configs
- `src/lib/services/pocketbase.ts` - PocketBase integration
- `src/lib/services/ai.ts` - AI extension stubs

---

## PocketBase Admin

- **URL**: http://localhost:8095/_/
- **Collections**: users, entries, projects, tags
- **API Rules**: All unlocked (empty = public access for dev)

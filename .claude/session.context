# Session Context - Homelab Notebook

**Last Updated:** 2025-12-01 (Night)
**Session Purpose:** Carta Markdown Editor Integration

---

## Workflow Progress

| Phase | Status | Notes |
|-------|--------|-------|
| Project Brief v2 | COMPLETE | .docs/homelab-notebook-brief-v1.md |
| UI/UX Redesign | COMPLETE | .docs/ui-ux-redesign-v2.md |
| Migration Phase 1-6 | COMPLETE | Core structure, features, polish |
| PocketBase Setup | COMPLETE | Collections on production VPS |
| App Init Fix | COMPLETE | Fixed SSR hydration blocking issue |
| UI Refresh | COMPLETE | Notion-inspired sidebar layout with mobile support |
| Deployment Strategy | COMPLETE | .docs/deployment-strategy-updated.md |
| Production PocketBase | COMPLETE | Connected to pocketbase.haugaard.dev |
| Dependency Fix | COMPLETE | Resolved vite version conflict |
| File Attachments | COMPLETE | Components ready, needs PocketBase field |
| Search Relocation | COMPLETE | Moved to Header center |
| Carta Editor | COMPLETE | On `editor` branch, ready to merge |

**Mode:** DELIVERY (practical utility focus)

---

## Current State

### Latest Session (2025-12-01 Night) - Carta Editor

#### Carta Markdown Editor (`editor` branch)
- Replaced basic textarea/preview with Carta markdown editor
- Added `carta-md` (4.11.1) and `isomorphic-dompurify` for XSS protection
- Tabs mode (Write / Preview) with live rendering
- Themed to match app CSS variables
- Same `bind:value` API — drop-in replacement
- **Commit**: `48c17b8`

#### Pending (tracked in `.claude/todo.md`)
- Upgrade vitest to v4 (resolves vite version conflict in `pnpm check`)

---

### Previous Session (2025-12-01 Late Evening) - UI & Attachments

#### Features Implemented

1. **File Attachments Feature**
   - Added `attachments` field to Entry type
   - Created `AttachmentDropZone` component (drag/drop + browse)
   - Created `AttachmentList` component (view/download existing)
   - Updated entry service for FormData file uploads
   - Supports PDF, DOCX, XLSX, images with type icons

2. **Form Layout Improvements**
   - Project selector: Narrower (`max-w-xs`)
   - Tags & Attachments: Side-by-side grid layout
   - Cleaner visual hierarchy

3. **Search Relocated to Header**
   - Moved from sidebar footer to Header center
   - Keyboard shortcut hint preserved (⌘K)
   - Removed duplicate from sidebar

4. **Project Navigation Fix**
   - Fixed sidebar project links not updating main view
   - Changed `onMount` to `$effect` for reactive data loading

#### Files Created
- `src/lib/components/ui/AttachmentDropZone.svelte`
- `src/lib/components/ui/AttachmentList.svelte`

#### Files Modified
- `src/lib/types/index.ts` - Added attachments field
- `src/lib/services/pocketbase.ts` - FormData upload support
- `src/lib/components/ui/index.ts` - Export new components
- `src/lib/components/layout/Header.svelte` - Added search bar
- `src/lib/components/layout/Sidebar.svelte` - Removed search
- `src/routes/research/new/+page.svelte` - New layout
- `src/routes/project/new/+page.svelte` - New layout
- `src/routes/reference/new/+page.svelte` - New layout
- `src/routes/projects/[id]/+page.svelte` - Fixed navigation

---

## Configuration

### Local Development (Both Machines)
- **PocketBase**: Production instance at `https://pocketbase.haugaard.dev`
- **ENV**: `PUBLIC_POCKETBASE_URL=https://pocketbase.haugaard.dev` in `.env.local`
- **API Rules**: All collections have empty rules (public access)
- **PocketBase Admin**: https://pocketbase.haugaard.dev/_/

### Production (VPS - Hostinger)
- **VPS**: 72.60.27.146 (8 cores, 32GB RAM)
- **PocketBase**: pocketbase.haugaard.dev (existing instance)
- **Frontend**: To be deployed at notebook.haugaard.dev
- **Reverse Proxy**: Caddy with automatic HTTPS

---

## PocketBase Setup Required

Add `attachments` field to `entries` collection:
- **Field type**: File
- **Max select**: Multiple
- **Max size**: 10MB
- **Allowed types**: (optional) `application/pdf, image/*, application/msword, application/vnd.openxmlformats-officedocument.*`

---

## Next Actions

1. Merge `editor` branch to `main`
2. Add `attachments` field to PocketBase `entries` collection
3. Test file upload/download functionality
4. Deploy frontend to VPS (notebook.haugaard.dev)
5. Upgrade vitest to v4 (on main)

---

## Reference Files

- `.docs/homelab-notebook-brief-v1.md` - Project brief
- `.docs/ui-ux-redesign-v2.md` - UI/UX specification
- `.docs/deployment-strategy-updated.md` - Deployment plan
- `CLAUDE.md` - Project documentation
- `src/lib/types/index.ts` - TypeScript types and mode configs
- `src/app.css` - Theme and design system
